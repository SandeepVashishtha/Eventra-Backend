# Profile management
spring.profiles.active=azure

# Azure Production Configuration
# This file can be safely committed to version control
# Actual secrets should be provided via Azure App Service Configuration

spring.application.name=backend

# Server Configuration for Azure App Service
server.port=${PORT:8080}

# Aiven MySQL Database Configuration
spring.datasource.url=${AIVEN_DATABASE_URL:jdbc:h2:mem:testdb}
spring.datasource.username=${AIVEN_DATABASE_USERNAME:sa}
spring.datasource.password=${AIVEN_DATABASE_PASSWORD:}
spring.datasource.driver-class-name=${DATABASE_DRIVER:org.h2.Driver}

# JPA Configuration for MySQL with fallbacks
spring.jpa.properties.hibernate.dialect=${DATABASE_DIALECT:org.hibernate.dialect.H2Dialect}
spring.jpa.hibernate.ddl-auto=${DDL_AUTO:update}
spring.jpa.show-sql=${SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=false

# MySQL specific settings
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# H2 Console disabled in production
spring.h2.console.enabled=false

# Connection Pool Configuration for Azure
spring.datasource.hikari.maximum-pool-size=${DB_MAX_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=${DB_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=${DB_CONNECTION_TIMEOUT:30000}
spring.datasource.hikari.idle-timeout=${DB_IDLE_TIMEOUT:600000}
spring.datasource.hikari.max-lifetime=${DB_MAX_LIFETIME:1800000}

# JWT Configuration with fallback
jwt.secret=${JWT_SECRET:defaultSecretForAzureProductionOnly}
jwt.expiration=${JWT_EXPIRATION:86400000}

# Azure Application Insights (if using)
azure.application-insights.instrumentation-key=${APPINSIGHTS_INSTRUMENTATIONKEY:}

# Logging Configuration for Azure
logging.level.com.eventra=INFO
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN
logging.level.org.hibernate=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Security settings for production
server.error.include-stacktrace=never
server.error.include-exception=false
server.error.include-message=on_param
server.error.include-binding-errors=never

# Azure-specific settings
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
management.health.db.enabled=true

# CORS Configuration for Azure - More permissive for debugging
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:*}
cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
cors.allowed-headers=*
cors.allow-credentials=true

# Session configuration for Azure
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.same-site=strict
